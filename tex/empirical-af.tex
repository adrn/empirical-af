% Notes:
% -

% \begin{figure}[!t]
% \begin{center}
% % \includegraphics[width=0.9\textwidth]{visitstats.pdf}
% {\color{red} Figure placeholder}
% \end{center}
% \caption{%
% TODO
% \label{fig:chiplots}
% }
% \end{figure}

\PassOptionsToPackage{usenames,dvipsnames}{xcolor}
\documentclass[modern]{aastex631}
% \documentclass[twocolumn]{aastex631}

% Load common packages
\usepackage{microtype}  % ALWAYS!
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{booktabs}
\usepackage{graphicx}
% \usepackage{color}

\usepackage{enumitem}
\setlist[description]{style=unboxed}

% Some style hacks:
\renewcommand{\twocolumngrid}{\onecolumngrid}
\setlength{\parindent}{1.1\baselineskip}
\addtolength{\topmargin}{-0.2in}
\addtolength{\textheight}{0.4in}
\sloppy\sloppypar\raggedbottom\frenchspacing

\graphicspath{{figures/}}
\input{preamble.tex}

\shorttitle{}
\shortauthors{Price-Whelan et al.}

\begin{document}

\title{
    Empirical Actions, Frequencies, and Angles: \\
    Data-driven Dynamics with 1D Kinematics
}

\newcommand{\affcca}{
    Center for Computational Astrophysics, Flatiron Institute, \\
    162 Fifth Ave, New York, NY 10010, USA
}

\author[0000-0003-0872-7098]{Adrian~M.~Price-Whelan}
\affiliation{\affcca}
\email{aprice-whelan@flatironinstitute.org}
\correspondingauthor{Adrian M. Price-Whelan}

\author{Jason A. S. Hunt}
\affiliation{\affcca}

\author{Daniel~Horta~Darrington}
\affiliation{\affcca}

\author{Kathryn Johnston}
% \affiliation{\affcolumbia}

% TODO: orcid, affs
\author{David~W.~Hogg}
% \affiliation{\affcca}
% \affiliation{\affnyu}
% \affiliation{\affmpia}

\author{Benjamin~Cassese}

\author{+ more}


\begin{abstract}\noindent
% Context
Orbital dynamics is complex in six-dimensional phase-space, making it a challenge to
interpret the rich and structured kinematic data of stars in the Milky Way revealed in
recent data releases from the \gaia\ Mission.
In a symmetric, steady-state galaxy, or in the presence of only weak perturbations, the
dynamical interpretation and investigation of kinematic data is often simplified by
using dynamical invariants such as orbital actions.
However, computing many such quantities (e.g., the energy, actions, fundamental
frequencies, etc.) require having a model for the gravitational potential and, even so,
are either slow to compute or imprecise.
% Aims.
To mitigate at least one of these limitations, we aim to demonstrate a method for
estimating fundamental galactic orbital properties for stars directly from the kinematic
and stellar label data (e.g., element abundances) without requiring a gravitational
potential model.
% Methods
This method still assumes a symmetric and steady-state distribution function, but uses
either the number density of stars in a slice of phase-space (e.g., vertical $z$--$v_z$
kinematics) or a statistic computed from other stellar invariants in this slice (e.g.,
element abundances) to empirically estimate orbital actions, frequencies, and angles for
the stars.
% Results
We demonstrate the method using a toy equilibrium model where orbital properties are
known, and then show applications of this method even in the presence of disequilibrium.
As a last demonstration, we use data from the \gaia\ Mission to estimate the total mass
density at the Galactic midplane as a function of radius near the sun.
% Conclusions
We conclude :shrugs:.

\end{abstract}

% \keywords{}

\section*{~}\clearpage

\section{Introduction} \label{sec:intro}

KVJ/JASH intro sketch:
The power and peril of actions. The promise of frequencies. Much can be learned without
actions. Soliloquy on frequencies. The Galaxy is a clock. Frequencies set how things
wind up and mix.

Also how they interact. A lot to be learned from frequencies alone.

Recent data sets suggest signatures of this mixing and interaction ... and hence Freq
directly - resonances, snails. Models typically within assumed potentials, but actually
information in there directly. Motivated by the peril of actions and the promise of
frequencies, this paper attempts to examine what can be learned without.... Approach
motivated by orbital torus imaging


\section{Methods} \label{sec:methods}

Our goal is to use the stellar phase-space density (or statistics computed from stellar
invariants) to infer a local transformation to actions, angles, and frequencies directly
from the data, i.e. without assuming the form of a gravitational potential model.
To do this, we make several assumptions or choices to simplify the problem:
\begin{description}
    \item[Axisymmetry] The gravitational potential that the stars orbit in is
    axisymmetric and smooth.
    \item[No interactions] The stars do not interact with one another and act
    effectively as test particles orbiting within the galactic mass distribution.
    \item[1D phase-space / vertical kinematics] Here, for simplicity, we will work with
    just one position and one velocity component. In the demonstrations below, we use
    the vertical kinematics $z, v_z$, but this could equally be applied to radial
    kinematics $R, v_R$.
    \item[Circular orbits] For the previous assumption to be a valid simplification, we
    also require that stars have negligible eccentricity (or zero radial action $J_R=0$)
    and have the same $z$-component of the angular momentum $L_z$ (or azimuthal action
    $J_\phi$).
    \item[Phase-mixed] The stellar distribution function (\df) in any vertical slice of
    the full phase-space is phase-mixed.
    % TODO: note the assumptions above mean we are working at many R's to have J_R=0 but
    % constant L_z
\end{description}
Under these assumptions --- and importantly in a slice of phase-space at fixed values of
the other actions --- contours of fixed phase-space density (or of fixed stellar
invariant statistics, like stellar abundances; \citealt{Price-Whelan:2021}) delineate
orbital trajectories.
% Argument is: E = 1/2 v_z^2 + Phi(z) -> v_z(z) is an orbit, so f(E) = const. -> v_z(z)
% is also an orbit
This motivates a conceptual path toward empirically determining dynamical quantities of
interest directly from the observed phase-space density or from statistics of stellar
labels computed in a slice of phase-space.
% TODO: figure 1 should be referenced here

\begin{figure*}[!th]
\begin{center}
\includegraphics[width=\textwidth]{illustrate-zvz.pdf}
\end{center}
\caption{%
TODO
\label{fig:zvz}
}
\end{figure*}

Given a closed orbital trajectory in a 1D phase-space, we can estimate dynamical
quantities like the orbital actions, angles, and frequencies.
For example, in terms of the vertical position and velocity $z, v_z$, where an orbit can
be parametrized as $v_z(z)$, the vertical action $J_z$ and period $T_z$ are given by
\begin{align}
    J_z &= \frac{2}{\pi} \, \int_0^{z_{\textrm{max}}} \dd z \, v_z(z) \\
    T_z &= 4 \, \int_0^{z_{\textrm{max}}} \frac{\dd z}{v_z(z)}\quad ,
\end{align}
which can then be used to compute the vertical (angular) frequency $\Omega_z =
\frac{2\pi}{T_z}$.
For a given stellar position and velocity $z, v_z$ along an orbit, the vertical angle
$\theta_z$ can be computed as the fraction of an orbital period traversed up to that
point,
\begin{equation}
    \theta_z = \frac{2\pi}{T_z} \, \int_0^{z} \frac{\dd w}{v_z(w)} \quad ,
\end{equation}
where $w$ is an integration variable.
In principle, with infinite particle resolution, one could extract contours of constant
density (or stellar labels) from an observed phase-space distribution and numerically
estimate the integrals above.
In practice, however, this would be noisy and unstable in regions of low phase-space
density, which are often the most interesting (e.g., the transition from disk-dominated
to halo-dominated kinematics).
Instead, in what follows we outline a method for modeling the continuous phase-space
density that enables computing the dynamical quantities.


\subsection{Estimating Dynamical Quantities from the Phase-space Density}

Given a distribution of $N$ stellar positions and velocities $\{z, v_z\}_N$, our task is
to infer the parameters of a functional model for the number density $n(z, v_z)$ that
also allows use to compute the dynamical quantities ($J_z$, $\Omega_z$, $\theta_z$) for
any individual $z, v_z$.
With our assumption that the \df\ is phase-mixed, the number density should only depend
on the phase-space coordinates through the action, so that $n(z, v_z) = n(J_z(z, v_z))$
At fixed $z$, say $z=0$, we expect that $J_z$ increases with increasing $v_z$ (orbits
with larger velocity at the midplane will reach larger heights) and $\Omega_z$
decreases with increasing $v_z$ (orbits that reach larger heights above the midplane
have longer periods).
Similar arguments can be made at fixed $v_z=0$ in considering how $J_z$ and $\Omega_z$
vary with increasing $z$.
It is therefore useful to construct an ellipsoidal polar coordinate system in the $z,
v_z$ plane with a radius coordinate $r_z'$ and a corresponding angle coordinates
$\theta_z'$ defined as
\begin{align}
    r_z' &= \sqrt{z^2 \, \omega_0 + v_z^2 \, \omega_0^{-1}} \label{eq:rzp} \\
    \theta_z' &= \tan^{-1}\left(\frac{z}{v_z}\,\omega_0\right) \label{eq:thetazp}
\end{align}
where $\omega_0$ is a scale frequency.
The vertical action $J_z$ and frequency $\Omega_z$ should be close to monotonic
functions of this polar radius $r_z'$.

For example, in a simple harmonic oscillator (SHO) potential,
\begin{equation}
    \Phi(z) = \frac{1}{2} \, \omega^2 \, z^2
\end{equation}
the Hamiltonian (total energy per unit mass) is
\begin{equation}
    H(z, v_z) = E_z = \frac{1}{2} \, v_z^2 + \frac{1}{2} \, \omega^2 \,z^2
\end{equation}
and the orbital action $J_z$ is given by
\begin{equation}
    J_z = \frac{E_z}{\omega} \quad .
\end{equation}
All orbits have the same frequency $\omega$ and are elliptical in the 1D phase-space.
In this case, the scale frequency $\omega_0$ in $r_z'$ corresponds to the frequency of
the oscillator $\omega_0=\omega$, the radius $r_z'$ is related to the action $J_z$ as
\begin{equation}
    J_z = \frac{1}{2} r_z'^2
\end{equation}
and the conjugate angle $\theta_z$ (conjugate to the action $J_z$) is equal to the
ellipsoidal angle $\theta_z = \theta_z'$.
The phase-mixed \df\ $f(J_z)$ can therefore be expressed as some
function of the polar radius alone $f(J_z)=g(r_z')$.

Orbits in even simple galactic mass models are more complex.
For example, in a two-component mass model consisting of a Galactic disk embedded in a
dark matter halo, the morphology of an orbit will depend on whether it is confined to
the disk or whether it feels the transition from the disk- to the halo-dominated region
of the mass distribution.
Figure~\ref{fig:zvz} (left panel) is an illustration that shows several sample orbits
with different values of the vertical action (spaced uniformly in $\sqrt{J_z}$), all
with $J_R=0$ and the same $J_\phi$ in a two-component galaxy model consisting of a
Miyamoyo--Nagai disk component \citep{Miyamoto:1975} and a Navarro--Frenk--White (NFW)
halo component \citep{NFW:1996}.
For this toy galaxy model, parameters are chosen to roughly match the local circular
velocity and scale height of the Milky Way disk, but this potential model is only used
for illustrative purposes (the parameter values are not important).
For smaller values of the vertical action, orbits are close to elliptical in shape.
Moving out in ``radius'' or vertical action $J_z$, orbits have frequencies that decrease
with increasing action (which manifests as a changing axis ratio of the orbits).
For orbits with larger vertical action (i.e. orbits that reach scale heights more than a
few times the adopted scale height $h_z=0.25~\kpc$), the orbits begin to significantly
feel the influence of the dark matter halo and the orbital trajectory shapes become more
``pinched'' or ``diamond''-like near $z=0$.
We expect these features to be generic for slices of the vertical kinematics in galaxies
like the Milky Way: The vertical frequency should be a smooth function of the vertical
action, and orbits will have more complex morphologies (i.e. more complex than
ellipses).

Whereas in a SHO potential the orbital trajectories are functionally equivalent
(ellipses) and scaled by the value of the action, in a more generic galactic mass model
we expect the trajectories to distort away from ellipses.
As we saw in Figure~\ref{fig:zvz}, this distortion changes the orbital frequency of
orbits with increased size or vertical action (i.e., changes the scale frequency of the
ellipse), but also introduces a morphological change by making the orbits more
diamond-shaped, especially close to $z=0$.
In terms of action--angle coordinates, this means that the ellipsoidal angle introduced
above (Equation~\ref{eq:thetazp}) is no longer equal to the conjugate angle $\theta_z$,
and any functional model for the phase-mixed \df\ $f(J)$ must be a function of both the
ellipsoidal radius and angle:
\begin{equation}
    f(J) = g(r_z', \theta_z') \quad .
\end{equation}
We choose to express this density model as a function of an auxiliary variable $r_z$
that is defined as a low-order Fourier expansion distortion to the ellipsoidal radius
$r_z'$:
\begin{align}
    r_z &= r_z' \, \left[1 + \sum_m \epsilon_m(r_z') \, \cos{\left(m\,\theta_z'\right)}\right] \label{eq:rz} \\
    n(z, v_z) &= n(r_z(r_z', \theta_z'))
\end{align}
where $n(\cdot)$ represents a density function and $\epsilon_m(r_z')$ represents a
distortion amplitude, whose magnitude is hopefully must smaller than one for all
relevant values of $r_z'$ --- that is, we assume that
\begin{equation}
    |\epsilon_m(r_z')| \ll 1 \,\, \forall r_z', m \quad .
\end{equation}

With this parametrization, the action and frequency are monotonic and smooth functions
of the distorted radius $r_z$: $J_z = J_z(r_z)$ and $\Omega_z = \Omega_z(r_z)$.
We can also now compute the dynamical quantities with integrals over the ellipsoidal
angle $\theta_z'$
\begin{align}
    J_z(r_z) &= \frac{2}{\pi} \, \int_0^{\pi/2} \dd \theta_z' \, v_z(\theta_z')
        \, \left|\frac{\dd z}{\dd \theta_z'}\right| \\
    T_z &= 4 \, \int_0^{\pi/2} \frac{\dd \theta_z'}{v_z(\theta_z')}
        \, \left|\frac{\dd z}{\dd \theta_z'}\right|
\end{align}
where
\begin{align}
    v_z(\theta_z') &= \sqrt{\omega_0} \, r_z'(r_z, \theta_z') \, \cos{(\theta_z')} \\
    z(\theta_z') &= \frac{1}{\sqrt{\omega_0}} \, r_z'(r_z, \theta_z') \, \sin{(\theta_z')}
\end{align}
and $r_z'(r_z, \theta_z')$ in general has to be found by numerical root-finding of
Equation~\ref{eq:rz}.


\subsection{Estimating Dynamical Quantities from Statistics of Stellar Labels}

TODO: same thing as previous subsection, but $F(r_z)$ instead of $n(r_z)$


\section{Results} \label{sec:results}

For our implementation used in this article, we adopt the following:
\begin{align}
    m &= \left\{2, 4\right\} \\
    e_2(r_z') &\geq 0 \,\,\forall r_z'\\
    e_4(r_z') &\leq 0 \,\,\forall r_z'
\end{align}
and we use linear splines to represent the functions $n(r_z)$, $e_2(r_z')$, and
$e_4(r_z')$.


\subsection{Demonstration with a Simple Equilibrium Model}
\label{sec:eq-model}


\subsection{Tests with a Perturbed Disk}
\label{sec:diseq-disk}


\subsection{Empirical Actions and Frequencies from \gaia\ Data Release 3}
\label{sec:gaiadr3}


\section{Discussion} \label{sec:discussion}


\section{Summary and Conclusions} \label{sec:conclusions}


\begin{acknowledgements}

It is a pleasure to thank ...

% Funding for the Sloan Digital Sky Survey IV has been provided by the Alfred P.
% Sloan Foundation, the U.S. Department of Energy Office of Science, and the
% Participating Institutions. SDSS-IV acknowledges support and resources from the
% Center for High-Performance Computing at the University of Utah. The SDSS web
% site is www.sdss.org.

% SDSS-IV is managed by the Astrophysical Research Consortium for the
% Participating Institutions of the SDSS Collaboration including the Brazilian
% Participation Group, the Carnegie Institution for Science, Carnegie Mellon
% University, the Chilean Participation Group, the French Participation Group,
% Harvard-Smithsonian Center for Astrophysics, Instituto de Astrof\'isica de
% Canarias, The Johns Hopkins University, Kavli Institute for the Physics and
% Mathematics of the Universe (IPMU) / University of Tokyo, Lawrence Berkeley
% National Laboratory, Leibniz Institut f\"ur Astrophysik Potsdam (AIP),
% Max-Planck-Institut f\"ur Astronomie (MPIA Heidelberg), Max-Planck-Institut
% f\"ur Astrophysik (MPA Garching), Max-Planck-Institut f\"ur Extraterrestrische
% Physik (MPE), National Astronomical Observatories of China, New Mexico State
% University, New York University, University of Notre Dame, Observat\'ario
% Nacional / MCTI, The Ohio State University, Pennsylvania State University,
% Shanghai Astronomical Observatory, United Kingdom Participation Group,
% Universidad Nacional Aut\'onoma de M\'exico, University of Arizona, University
% of Colorado Boulder, University of Oxford, University of Portsmouth, University
% of Utah, University of Virginia, University of Washington, University of
% Wisconsin, Vanderbilt University, and Yale University.

This work has made use of data from the European Space Agency (ESA) mission
{\it Gaia} (\url{https://www.cosmos.esa.int/gaia}), processed by the {\it Gaia}
Data Processing and Analysis Consortium (DPAC,
\url{https://www.cosmos.esa.int/web/gaia/dpac/consortium}). Funding for the DPAC
has been provided by national institutions, in particular the institutions
participating in the {\it Gaia} Multilateral Agreement.

\end{acknowledgements}

\software{
    Astropy \citep{astropy:2013, astropy:2018, astropy:2022},
    gala \citep{gala},
    IPython \citep{ipython},
    numpy \citep{numpy},
    % pymc3 \citep{Salvatier2016},
    % schwimmbad \citep{schwimmbad:2017},
    scipy \citep{scipy}.
}

\bibliographystyle{aasjournal}
\bibliography{empirical-af}

\end{document}
